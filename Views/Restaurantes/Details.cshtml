@model appReservas.Models.Restaurante

@{
    ViewData["Title"] = "Detalles";
    var apiKey = ViewData["GoogleMapsApiKey"]?.ToString();
}

@using Microsoft.AspNetCore.Identity
@inject SignInManager<ApplicationUser> SignInManager

<!-- Imagen de portada -->
<div class="position-relative" style="height: 80vh; overflow: hidden;">
    <img src="@Model.ImagenUrl" class="w-100 h-100" style="object-fit: cover;" alt="@Model.Nombre" />
    <div class="position-absolute top-0 start-0 w-100 h-100" style="background: rgba(0,0,0,0.4);"></div>

    <div class="position-absolute top-50 start-50 translate-middle text-center text-white">
        <h1 class="display-4 fw-bold">@Model.Nombre</h1>
        <p class="fs-5">
            ‚≠ê @Model.Rating &nbsp; | &nbsp; üí∞ S/. @Model.PrecioPromedio &nbsp; | &nbsp; üçΩ @Model.Tipo
        </p>

        @if (SignInManager.IsSignedIn(User))
        {
            <a href="#reservaSection" class="btn btn-warning btn-lg mt-3">üìÖ Reservar Mesa</a>
        }
        else
        {
            <a href="/Identity/Account/Login" class="btn btn-outline-light btn-lg mt-3">
                üîê Inicia sesi√≥n para reservar
            </a>
        }
    </div>
</div>

<!-- Secci√≥n sobre el restaurante -->
<section class="container py-5" id="reservaSection">
    <div class="row mb-5">
        <div class="col-md-8 mx-auto text-center">
            <h2 class="fw-bold mb-3">Sobre @Model.Nombre</h2>
            <p class="text-muted fs-5">
                Bienvenido a @Model.Nombre, donde ofrecemos platos deliciosos y experiencias gastron√≥micas √∫nicas en @Model.Distrito.
            </p>
        </div>
    </div>

    <!-- Mapa del restaurante -->
    <div class="row justify-content-center mb-5">
        <div class="col-md-10">
            <div id="map" style="height:400px;width:100%;" class="shadow-sm rounded-4"></div>
        </div>
    </div>

    <!-- Formulario de reserva -->
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card shadow-lg p-4 rounded-4">
                <h3 class="fw-bold mb-4 text-center">Hacer una Reserva</h3>

                @if (TempData["SuccessMessage"] != null)
                {
                    <div class="alert alert-success">@TempData["SuccessMessage"]</div>
                }
                @if (TempData["ErrorMessage"] != null)
                {
                    <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
                }

                @if (SignInManager.IsSignedIn(User))
                {
                    <form asp-action="Create" asp-controller="Reservas" method="post">
                        <input type="hidden" name="restauranteId" value="@Model.Id" />

                        <div class="mb-3">
                            <label for="fecha" class="form-label">Fecha</label>
                            <input type="date" class="form-control" id="fecha" name="Fecha" required min="@DateTime.Now.ToString("yyyy-MM-dd")">
                        </div>

                        <div class="mb-3">
                            <label for="personas" class="form-label">N√∫mero de Personas</label>
                            <input type="number" class="form-control" id="personas" name="Personas" min="1" max="20" required>
                        </div>

                        <button type="submit" class="btn btn-warning w-100 fw-bold">üìÖ Reservar</button>
                    </form>
                }
                else
                {
                    <div class="alert alert-info text-center">
                        üîê Debes <a href="/Identity/Account/Login" class="fw-bold text-decoration-none">iniciar sesi√≥n</a> para hacer una reserva.
                    </div>
                }
            </div>
        </div>
    </div>
</section>

@section Scripts{
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=@apiKey&callback=initMap">
    </script>

    <script>
        function initMap() {
            var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 16,
                center: { lat: @Model.Latitude, lng: @Model.Longitude }
            });

            new google.maps.Marker({
                position: { lat: @Model.Latitude, lng: @Model.Longitude },
                map: map,
                title: "@Model.Nombre"
            });
        }

        // Scroll suave
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
    </script>
}
