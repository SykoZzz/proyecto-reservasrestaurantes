<div id="chatbot-toggle">
    ðŸ’¬
</div>

<div id="chatbot-window" class="chatbot-hidden">
    <div class="chatbot-header">
        Asistente de restaurantes
        <span id="chatbot-close">âœ–</span>
    </div>
    <div id="chatbot-messages"></div>
    <div class="chatbot-input-area">
        <input id="chatbot-input" type="text" placeholder="PregÃºntame algo..." />
        <button id="chatbot-send">Enviar</button>
    </div>
</div>

<style>
    #chatbot-toggle {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 56px;
        height: 56px;
        border-radius: 50%;
        background-color: #BA965A;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(0,0,0,0.25);
        z-index: 9999;
    }

    #chatbot-window {
        position: fixed;
        bottom: 90px;
        right: 20px;
        width: 320px;
        max-height: 420px;
        background: #ffffff;
        border-radius: 10px;
        box-shadow: 0 4px 16px rgba(0,0,0,0.3);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        z-index: 9999;
    }

    .chatbot-hidden {
        display: none;
    }

    .chatbot-header {
        background: #222;
        color: #fff;
        padding: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    #chatbot-messages {
        padding: 10px;
        flex: 1;
        overflow-y: auto;
        background: #f7f7f7;
        font-size: 0.9rem;
    }

    .chatbot-message {
        margin-bottom: 8px;
        padding: 8px 10px;
        border-radius: 8px;
        max-width: 90%;
    }

    .chatbot-message.user {
        background: #BA965A;
        color: white;
        margin-left: auto;
    }

    .chatbot-message.bot {
        background: #fff;
        border: 1px solid #ddd;
        margin-right: auto;
    }

    .chatbot-input-area {
        display: flex;
        border-top: 1px solid #ddd;
    }

    #chatbot-input {
        flex: 1;
        border: none;
        padding: 8px;
    }

    #chatbot-send {
        background: #BA965A;
        color: white;
        border: none;
        padding: 0 12px;
        cursor: pointer;
    }
</style>

<script>
    (function () {
        const toggle = document.getElementById("chatbot-toggle");
        const windowEl = document.getElementById("chatbot-window");
        const closeBtn = document.getElementById("chatbot-close");
        const input = document.getElementById("chatbot-input");
        const sendBtn = document.getElementById("chatbot-send");
        const messages = document.getElementById("chatbot-messages");

        function appendMessage(role, text) {
            const div = document.createElement("div");
            div.classList.add("chatbot-message", role);
            div.innerText = text;
            messages.appendChild(div);
            messages.scrollTop = messages.scrollHeight;
        }

        async function sendMessage() {
            const text = input.value.trim();
            if (!text) return;

            appendMessage("user", text);
            input.value = "";

            appendMessage("bot", "Pensando...");

            try {
                const response = await fetch("/api/chat/message", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ message: text })
                });

                const data = await response.json();
                messages.lastChild.remove();
                appendMessage("bot", data.reply);
            } catch {
                messages.lastChild.remove();
                appendMessage("bot", "Error al contactar con la IA ðŸ˜¢.");
            }
        }

        toggle.onclick = () => windowEl.classList.toggle("chatbot-hidden");
        closeBtn.onclick = () => windowEl.classList.add("chatbot-hidden");
        sendBtn.onclick = sendMessage;
        input.addEventListener("keydown", e => { if (e.key === "Enter") sendMessage(); });
    })();
</script>
